{% extends 'dashboard/admin_base.html' %}

{% block title %}Admin Notifications{% endblock %}
{% block page_title %}Notifications{% endblock %}

{% block content_admin %}
<body data-mark-read-url="{% url 'admin_notifications_mark_read' %}">

<div class="notifications-wrapper">

    <!-- ðŸ”¹ Header: unread count -->
    {% if unread_count > 0 %}
        <div class="unread-header">
            <!-- <i class="fa-solid fa-bell"></i> -->
            <!-- You have <strong>{{ unread_count }}</strong> new notification{{ unread_count|pluralize }} -->
             Unread
        </div>

    {% endif %}

    <!-- ðŸ”¹ Unread notifications -->
    {% if unread_notifications %}
        <div class="notif-section">
            {% for notif in unread_notifications %}
            <div class="notif-item unread">
                <p class="notif-message">{{ notif.message }}</p>
                <span class="notif-time">{{ notif.created_at|date:"Y-m-d H:i" }}</span>
            </div>
            {% endfor %}
        </div>

        <!-- Divider line -->
        <hr class="notif-divider">
    {% endif %}

    <!-- ðŸ”¹ Read notifications -->
    {% if read_notifications %}
        <div class="notif-section read-section">
            {% for notif in read_notifications %}
            <div class="notif-item read">
                <p class="notif-message">{{ notif.message }}</p>
                <span class="notif-time">{{ notif.created_at|date:"Y-m-d H:i" }}</span>
            </div>
            {% endfor %}
        </div>
    {% else %}
        {% if not unread_notifications %}
        <p class="no-notif">No notifications yet.</p>
        {% endif %}
    {% endif %}
</div>

<style>
.notifications-wrapper {
    max-width: 700px;
    margin: 0 auto;
    background: #fff;
    border-radius: 12px;
    padding: 25px 30px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.unread-header {
    font-size: 16px;
    font-weight: 600;
    color: #8B0000;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.notif-section {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.notif-item {
    border-radius: 10px;
    padding: 12px 16px;
    transition: 0.2s;
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.notif-item.unread {
    background-color: #fff5f5;
    border-left: 4px solid #8B0000;
}
.notif-item.read {
    background-color: #f9f9f9;
    color: #555;
}
.notif-item:hover {
    background-color: #ffe6e6;
}

.notif-message {
    margin: 0;
    text-align: left;
    flex: 1;
}
.notif-time {
    font-size: 13px;
    color: #777;
    white-space: nowrap;
    margin-left: 10px;
}

.notif-divider {
    border: none;
    height: 2px;
    background-color: #8B0000;
    margin: 25px 0 10px 0;
}

.no-notif {
    text-align: center;
    color: #888;
    font-style: italic;
}
</style>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const markReadUrl = document.body.dataset.markReadUrl;
    const notifCount = document.querySelector(".notif-count");

    // âœ… Send AJAX call to mark all as read when page is opened
    fetch(markReadUrl, {
        method: "POST",
        headers: {
            "X-CSRFToken": getCSRFToken(),
            "Content-Type": "application/json",
        },
    }).then(res => res.json()).then(data => {
        if (data.success && notifCount) {
            // Smooth fade-out effect
            notifCount.style.transition = "opacity 0.5s ease";
            notifCount.style.opacity = "0";
            setTimeout(() => notifCount.remove(), 500);
        }
    });

    // Helper function for CSRF
    function getCSRFToken() {
        const cookie = document.cookie.split('; ').find(row => row.startsWith('csrftoken='));
        return cookie ? cookie.split('=')[1] : '';
    }
});
</script>

{% endblock %}
